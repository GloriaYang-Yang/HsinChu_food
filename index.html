<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒé£¯çš‡å¸å¤§ - é›²ç«¯åŒæ­¥ç‰ˆ</title>
    <style>
        /* å»¶ç”¨ä¹‹å‰çš„æ¨£å¼ï¼Œåƒ…å¢åŠ è®€å–å‹•ç•« */
        /* æŠŠé€™æ®µåŠ åœ¨ <style> æ¨™ç±¤å…§ */
        h1::before {
            content: "ğŸ³ "; /* åœ¨æ¨™é¡Œå‰é¢åŠ å€‹å¯æ„›çš„è·åŒ…è›‹ */
        }

        .container {
            border-top: 10px solid #ffbe0b; /* æ›ä¸€å€‹æš–æ´‹æ´‹çš„æ—©é¤é»ƒé¡è‰² */
        }
        :root { --main-color: #e67e22; --bg-color: #fff9f2; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); text-align: center; padding: 20px; }
        .container { max-width: 450px; margin: auto; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        select, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; font-size: 16px; border: 1px solid #ddd; }
        button {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            box-shadow: 0 4px 15px rgba(211, 84, 0, 0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        #result { margin-top: 25px; display: none; padding: 20px; background: #fffcf0; border-radius: 15px; border: 1px solid #ffeaa7; }
        .loading { color: #999; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¤´ åƒé£¯çš‡å¸å¤§ (é›²ç«¯ç‰ˆ)</h1>
    <div id="status" class="loading">æ­£åœ¨å‘å¾¡è†³æˆ¿èª¿é–±æ¸…å–®...</div>
    
    <div id="main-ui" style="display:none;">
        <select id="mood">
            <option value="breakfast">â˜• æ—©å®‰æ™¨ä¹‹ç¾</option>
            <option value="korean">ğŸŒ¶ï¸ éŸ“å¼æ–™ç†</option>
            <option value="light">ğŸ¥— è¼•é£Ÿéºµé£Ÿ</option>
            <option value="heavy">ğŸ¥© é£½è¶³å¤§é¤</option>
            <option value="fancy">ğŸ· è³ªæ„Ÿæ°£æ°›</option>
            <option value="local">ğŸš åœ¨åœ°åƒç²—é£½</option>
        </select>
        <button onclick="pickFood()">ç¿»ç‰Œå­</button>
        <div id="result">
            <div id="foodName" le="font-size: 22px; font-weight: bold;"></div>
            <p id="foodReason" style="color: #636e72;"></p>
            <a id="mapBtn" target="_blank" style="color: #0984e3; font-weight: bold; text-decoration: none;">ğŸ“ åœ°åœ–é–‹å•Ÿ</a>
        </div>
    </div>
</div>

<script>
    // âš ï¸ é€™è£¡è²¼ä¸Šä½ å¾ Google è©¦ç®—è¡¨ç™¼å¸ƒçš„ CSV ç¶²å€
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1a-YS-sVsEOoP-K5efI4VzueDPRLXNhe4Xl_Lrg1asd2ovmTF--E1oiJYiWQOkeChrpkWQuMQ4v_r/pub?output=csv'; 
    let cloudDatabase = [];

    // åˆå§‹åŒ–è®€å–è³‡æ–™
    async function init() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            // å…ˆéæ¿¾æ‰å®Œå…¨ç©ºç™½çš„è¡Œï¼Œå†é€²è¡Œè™•ç†
            const rows = data.split('\n').filter(row => row.trim() !== '').slice(1); 
            
            cloudDatabase = rows.map(row => {
                const cols = row.split(',');
                // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹æ¬„ä½ (category, name)
                if (cols.length >= 2) {
                    return { 
                        category: cols[0] ? cols[0].trim() : '', 
                        name: cols[1] ? cols[1].trim() : 'æœªå‘½ååº—å', 
                        reason: cols[2] ? cols[2].trim() : 'åœ¨åœ°ç¾é£Ÿå®¶æ¨è–¦' 
                    };
                }
                return null;
            }).filter(item => item !== null); // ç§»é™¤æ ¼å¼éŒ¯èª¤çš„è¡Œ

            if (cloudDatabase.length === 0) throw new Error('No data');

            document.getElementById('status').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
        } catch (e) {
            console.error(e);
            document.getElementById('status').innerText = 'å¾¡è†³æˆ¿é€£ç·šå¤±æ•—ï¼Œè«‹ç¢ºèªè©¦ç®—è¡¨å·²ç™¼å¸ƒç‚º CSVã€‚';
        }
    }

    function pickFood() {
        const mood = document.getElementById('mood').value;
        const choices = cloudDatabase.filter(item => item.category === mood);
        
        if (choices.length === 0) {
            alert('é€™é¡åˆ¥ç›®å‰æ²’æ”¶éŒ„å–”ï¼å¿«å»è©¦ç®—è¡¨åŠ ä¸€ä¸‹ã€‚');
            return;
        }

        const res = choices[Math.floor(Math.random() * choices.length)];
        document.getElementById('foodName').innerText = res.name;
        document.getElementById('foodReason').innerText = res.reason;
        document.getElementById('mapBtn').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(res.name)}`;
        document.getElementById('result').style.display = 'block';
    }

    init();
    function openForm() {
        document.getElementById('formModal').style.display = 'flex';
        // æ¯æ¬¡é–‹å•Ÿæ™‚é‡æ–°è®€å– iframeï¼Œç¢ºä¿çœ‹åˆ°æœ€æ–°è¡¨å–®
        const iframe = document.getElementById('googleFormIframe');
        iframe.src = iframe.src; 
    }
    
    function closeForm() {
        document.getElementById('formModal').style.display = 'none';
    }
    
    // é»æ“Šå½ˆçª—å¤–éƒ¨ä¹Ÿå¯ä»¥é—œé–‰ (è²¼å¿ƒåŠŸèƒ½)
    window.onclick = function(event) {
        const modal = document.getElementById('formModal');
        if (event.target == modal) {
            closeForm();
        }
    }
</script>
<button onclick="openForm()" id="floatingBtn" title="æˆ‘è¦è–¦é¤">â•</button>

<div id="formModal" class="modal-overlay">
    <div class="modal-content">
        <span onclick="closeForm()" class="close-btn">&times;</span>
        <h3 style="margin-top:0; color:#bc6c25;">ğŸ¤´ å¥å ±æ–°ç¾é£Ÿ</h3>
        <p style="font-size:12px; color:#666;">åœ¨ Threads çœ‹åˆ°å¥½æ–™ï¼Ÿå¿«å‘ˆä¸Šä¾†çµ¦æœ•ç§ç§ï¼</p>
        
        <iframe 
            id="googleFormIframe"
            src="https://docs.google.com/forms/d/e/æ‚¨çš„è¡¨å–®ID/viewform?embedded=true" 
            width="100%" 
            height="450" 
            frameborder="0" 
            marginheight="0" 
            marginwidth="0">è¼‰å…¥ä¸­â€¦</iframe>
    </div>
</div>

<style>
    /* æ‡¸æµ®æŒ‰éˆ•æ¨£å¼ */
    #floatingBtn {
        position: fixed; bottom: 25px; right: 25px;
        width: 60px; height: 60px;
        background: #000; color: #fff;
        border: none; border-radius: 50%;
        font-size: 30px; cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 1000; transition: 0.3s;
    }
    #floatingBtn:hover { transform: scale(1.1) rotate(90deg); }

    /* å½ˆçª—é®ç½©ï¼šåŠé€æ˜èƒŒæ™¯ */
    .modal-overlay {
        display: none; position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ„Ÿ */
        z-index: 2000; align-items: center; justify-content: center;
    }

    /* å½ˆçª—ä¸»é«” */
    .modal-content {
        background: white; padding: 25px;
        border-radius: 20px; width: 90%; max-width: 450px;
        position: relative; animation: slideUp 0.4s ease-out;
    }

    /* é—œé–‰æŒ‰éˆ• */
    .close-btn {
        position: absolute; top: 15px; right: 20px;
        font-size: 28px; cursor: pointer; color: #999;
    }

    /* å½ˆçª—å‹•ç•« */
    @keyframes slideUp {
        from { transform: translateY(50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
</style>
    
</body>
</html>






